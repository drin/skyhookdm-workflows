steps:
- id: copy ceph config
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./scripts/download_ceph_config.sh']

- id: build ceph-client image
  uses: docker://docker:19.03.3
  args: [
    'build',
    '-t',
    'jcnitdgp25/ceph-client:latest',
    './ceph-client'
  ]

- uses: docker://docker:19.03.3
  secrets: [
    'DOCKER_USERNAME',
    'DOCKER_PASSWORD'
  ]
  runs: ['/bin/sh']
  args:
  - -c
  - |
    docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
    docker push jcnitdgp25/ceph-client:latest

- id: start client nodes
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./scripts/setup_ceph_clients.sh']

- id: teardown client nodes
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./scripts/teardown_ceph_clients.sh']
