steps:
- id: build iperf client image
  uses: docker://docker:19.03.3
  args: [
    'build', 
    '-t', 
    'jcnitdgp25/iperf-client:latest', 
    './iperf/iperf-client'
  ]

- id: push iperf-client image to dockerhub
  uses: docker://docker:19.03.3
  secrets: [
    'DOCKER_USERNAME',
    'DOCKER_PASSWORD'
  ]
  runs: ['/bin/sh']
  args:
  - -c
  - |
    docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
    docker push jcnitdgp25/iperf-client:latest

- id: setup iperf tests
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./iperf/setup_iperf_tests.sh']
  secrets: ['DOCKER_USERNAME']
  env:
    replicas: '2'

- id: teardown iperf tests
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./iperf/teardown_iperf_tests.sh']
